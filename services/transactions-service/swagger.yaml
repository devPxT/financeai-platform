openapi: 3.0.3
info:
  title: Transactions Service
  version: 1.0.1
  description: |
    Microserviço responsável pelo CRUD de transações financeiras.
    Campos obrigatórios: userId, name, type, category, paymentMethod, amount.
servers:
  - url: http://localhost:4100
    description: Local Dev
  - url: https://financeaitransactions-djaggnewe5d6agah.canadacentral-01.azurewebsites.net
    description: Produção
tags:
  - name: Transactions
    description: CRUD de transações
  - name: Internal
    description: Endpoints internos/seed
paths:
  /transactions:
    get:
      tags: [Transactions]
      summary: Listar transações
      description: Lista transações do usuário (opcionalmente filtrando por período).
      parameters:
        - in: query
          name: userId
          schema: { type: string }
        - in: query
          name: from
          schema: { type: string, format: date-time }
        - in: query
          name: to
          schema: { type: string, format: date-time }
        - in: query
          name: limit
          schema: { type: integer, default: 300, minimum: 1 }
      responses:
        '200':
          description: Lista de transações
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Transaction'
        '500':
          description: Erro interno
    post:
      tags: [Transactions]
      summary: Criar transação
      description: Cria uma nova transação.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransactionCreate'
      responses:
        '201':
          description: Criada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transaction'
        '400':
          description: Campos faltando
        '500':
          description: Erro interno
  /transactions/{id}:
    put:
      tags: [Transactions]
      summary: Atualizar transação
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransactionUpdate'
      responses:
        '200':
          description: Atualizada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Transaction'
        '404':
          description: Não encontrada
        '500':
          description: Erro interno
    delete:
      tags: [Transactions]
      summary: Remover transação
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Removida
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok: { type: boolean }
        '404':
          description: Não encontrada
        '500':
          description: Erro interno
  /transactions/summary:
    get:
      tags: [Transactions]
      summary: Resumo de entradas/saídas
      parameters:
        - in: query
          name: userId
          schema: { type: string }
      responses:
        '200':
          description: Resumo financeiro
          content:
            application/json:
              schema:
                type: object
                properties:
                  totalEntrada: { type: number }
                  totalSaida: { type: number }
                  balance: { type: number }
                  count: { type: integer }
        '500':
          description: Erro interno
  /internal/seed:
    post:
      tags: [Internal]
      summary: Popular base demo
      x-internal: true
      security: []
      parameters:
        - in: header
          name: x-internal-secret
          schema: { type: string }
          required: false
      responses:
        '200':
          description: Resultado do seed
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok: { type: boolean }
                  r:
                    type: object
                    properties:
                      created: { type: integer }
        '401':
          description: Unauthorized (segredo inválido)
        '500':
          description: Erro interno
components:
  schemas:
    Transaction:
      type: object
      properties:
        _id: { type: string }
        userId: { type: string }
        name: { type: string }
        type:
          type: string
          enum: [Despesa, Depósito, Investimento]
        category:
          type: string
          enum: [Educação, Entretenimento, Alimentação, Saúde, Moradia, Outros, Salário, Transporte, Utilidades]
        paymentMethod:
          type: string
          enum: [Transferência Bancária, Boleto Bancário, Dinheiro, Cartão de Crédito, Cartão de Débito, Outros, Pix]
        amount: { type: number }
        date: { type: string, format: date-time }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
    TransactionCreate:
      type: object
      required: [userId, name, type, category, paymentMethod, amount]
      properties:
        userId: { type: string }
        name: { type: string }
        type: { type: string, enum: [Despesa, Depósito, Investimento] }
        category:
          type: string
          enum: [Educação, Entretenimento, Alimentação, Saúde, Moradia, Outros, Salário, Transporte, Utilidades]
        paymentMethod:
          type: string
          enum: [Transferência Bancária, Boleto Bancário, Dinheiro, Cartão de Crédito, Cartão de Débito, Outros, Pix]
        amount: { type: number }
        date: { type: string, format: date-time }
    TransactionUpdate:
      type: object
      properties:
        name: { type: string }
        type: { type: string, enum: [Despesa, Depósito, Investimento] }
        category:
          type: string
          enum: [Educação, Entretenimento, Alimentação, Saúde, Moradia, Outros, Salário, Transporte, Utilidades]
        paymentMethod:
          type: string
          enum: [Transferência Bancária, Boleto Bancário, Dinheiro, Cartão de Crédito, Cartão de Débito, Outros, Pix]
        amount: { type: number }
        date: { type: string, format: date-time }